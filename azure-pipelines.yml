resources:
- repo: self

queue:
  name: Hosted Linux Preview

steps:
- task: Docker@1
  displayName: 'Build an image'
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryEndpoint: 'Docker Hub'
    imageName: sboulema/mapviewer
    includeLatestTag: true

- task: Docker@1
  displayName: 'Push an image'
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryEndpoint: 'Docker Hub'
    command: 'Push an image'
    imageName: sboulema/mapviewer
    includeLatestTag: true

- task: SSH@0
  displayName: 'Deploy and image'
  inputs:
    sshEndpoint: CurleezBox
    commands: |
     sudo docker-compose -f /home/sboulema/stackfiles/MapViewer.yml pull
     sudo docker-compose -f /home/sboulema/stackfiles/MapViewer.yml up -d